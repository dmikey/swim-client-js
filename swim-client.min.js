!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.swim||(t.swim={})).client=e()}}(function(){return function e(t,n,o){function i(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return i(n?n:e)},h,h.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){t.exports={version:"0.4.0"}},{}],2:[function(e,t,n){},{}],3:[function(e,t,n){t.exports={version:"0.4.0"}},{}],4:[function(e,t,n){"use strict";function o(e){switch(k.tag(e)){case"@event":return p.decode(e);case"@command":return u.decode(e);case"@link":return d.decode(e);case"@linked":return f.decode(e);case"@sync":return y.decode(e);case"@synced":return v.decode(e);case"@unlink":return b.decode(e);case"@unlinked":return g.decode(e)}}function i(e){return e.encode()}function r(e){return o(k.parse(e))}function s(e){return k.stringify(i(e))}function a(){}function c(){a.call(this)}function l(){a.call(this)}function h(){a.call(this)}function p(e,t,n){h.call(this),this.node=e,this.lane=t,this.body=n}function u(e,t,n){h.call(this),this.node=e,this.lane=t,this.body=n}function d(e,t,n,o){c.call(this),this.node=e,this.lane=t,this.prio=n||0,this.body=o}function f(e,t,n,o){l.call(this),this.node=e,this.lane=t,this.prio=n||0,this.body=o}function y(e,t,n,o){c.call(this),this.node=e,this.lane=t,this.prio=n||0,this.body=o}function v(e,t,n){l.call(this),this.node=e,this.lane=t,this.body=n}function b(e,t,n){c.call(this),this.node=e,this.lane=t,this.body=n}function g(e,t,n){l.call(this),this.node=e,this.lane=t,this.body=n}var m=e("./config.json"),k=e("recon-js");Object.defineProperty(a.prototype,"isRequest",{value:!1}),Object.defineProperty(a.prototype,"isResponse",{value:!1}),Object.defineProperty(a.prototype,"isMessage",{value:!1}),Object.defineProperty(a.prototype,"isEventMessage",{value:!1}),Object.defineProperty(a.prototype,"isCommandMessage",{value:!1}),Object.defineProperty(a.prototype,"isLinkRequest",{value:!1}),Object.defineProperty(a.prototype,"isLinkedResponse",{value:!1}),Object.defineProperty(a.prototype,"isSyncRequest",{value:!1}),Object.defineProperty(a.prototype,"isSyncedResponse",{value:!1}),Object.defineProperty(a.prototype,"isUnlinkRequest",{value:!1}),Object.defineProperty(a.prototype,"isUnlinkedResponse",{value:!1}),c.prototype=Object.create(a.prototype),c.prototype.constructor=c,Object.defineProperty(c.prototype,"isRequest",{value:!0}),l.prototype=Object.create(a.prototype),l.prototype.constructor=l,Object.defineProperty(c.prototype,"isResponse",{value:!0}),h.prototype=Object.create(a.prototype),h.prototype.constructor=h,Object.defineProperty(c.prototype,"isMessage",{value:!0}),p.prototype=Object.create(h.prototype),p.prototype.constructor=p,Object.defineProperty(p.prototype,"isEventMessage",{value:!0}),p.prototype.withAddress=function(e,t){return void 0===e&&(e=this.node),void 0===t&&(t=this.lane),new p(e,t,this.body)},p.prototype.encode=function(){var e=[{node:this.node},{lane:this.lane}];return k.concat({"@event":e},this.body)},p.decode=function(e){for(var t,n,o=k.tail(e),i=k.head(e),r=i&&i.length||0,s=0;r>s;s+=1){var a=i[s];void 0!==a.node?t=a.node:void 0!==a.lane?n=a.lane:0===s?t=a:1===s&&(n=a)}return void 0!==t&&void 0!==n?new p(t,n,o):void 0},u.prototype=Object.create(h.prototype),u.prototype.constructor=u,Object.defineProperty(u.prototype,"isCommandMessage",{value:!0}),u.prototype.withAddress=function(e,t){return void 0===e&&(e=this.node),void 0===t&&(t=this.lane),new u(e,t,this.body)},u.prototype.encode=function(){var e=[{node:this.node},{lane:this.lane}];return k.concat({"@command":e},this.body)},u.decode=function(e){for(var t,n,o=k.tail(e),i=k.head(e),r=i&&i.length||0,s=0;r>s;s+=1){var a=i[s];void 0!==a.node?t=a.node:void 0!==a.lane?n=a.lane:0===s?t=a:1===s&&(n=a)}return void 0!==t&&void 0!==n?new u(t,n,o):void 0},d.prototype=Object.create(c.prototype),d.prototype.constructor=d,Object.defineProperty(d.prototype,"isLinkRequest",{value:!0}),d.prototype.withAddress=function(e,t){return void 0===e&&(e=this.node),void 0===t&&(t=this.lane),new d(e,t,this.prio,this.body)},d.prototype.encode=function(){var e=[{node:this.node},{lane:this.lane}];return this.prio&&e.push({prio:this.prio}),k.concat({"@link":e},this.body)},d.decode=function(e){for(var t,n,o,i=k.tail(e),r=k.head(e),s=r&&r.length||0,a=0;s>a;a+=1){var c=r[a];void 0!==c.node?t=c.node:void 0!==c.lane?n=c.lane:void 0!==c.prio?o=c.prio:0===a?t=c:1===a&&(n=c)}return void 0!==t&&void 0!==n?new d(t,n,o,i):void 0},f.prototype=Object.create(l.prototype),f.prototype.constructor=f,Object.defineProperty(f.prototype,"isLinkedResponse",{value:!0}),f.prototype.withAddress=function(e,t){return void 0===e&&(e=this.node),void 0===t&&(t=this.lane),new f(e,t,this.prio,this.body)},f.prototype.encode=function(){var e=[{node:this.node},{lane:this.lane}];return this.prio&&e.push({prio:this.prio}),k.concat({"@linked":e},this.body)},f.decode=function(e){for(var t,n,o,i=k.tail(e),r=k.head(e),s=r&&r.length||0,a=0;s>a;a+=1){var c=r[a];void 0!==c.node?t=c.node:void 0!==c.lane?n=c.lane:void 0!==c.prio?o=c.prio:0===a?t=c:1===a&&(n=c)}return void 0!==t&&void 0!==n?new f(t,n,o,i):void 0},y.prototype=Object.create(c.prototype),y.prototype.constructor=y,Object.defineProperty(y.prototype,"isSyncRequest",{value:!0}),y.prototype.withAddress=function(e,t){return void 0===e&&(e=this.node),void 0===t&&(t=this.lane),new y(e,t,this.prio,this.body)},y.prototype.encode=function(){var e=[{node:this.node},{lane:this.lane}];return this.prio&&e.push({prio:this.prio}),k.concat({"@sync":e},this.body)},y.decode=function(e){for(var t,n,o,i=k.tail(e),r=k.head(e),s=r&&r.length||0,a=0;s>a;a+=1){var c=r[a];void 0!==c.node?t=c.node:void 0!==c.lane?n=c.lane:void 0!==c.prio?o=c.prio:0===a?t=c:1===a&&(n=c)}return void 0!==t&&void 0!==n?new y(t,n,o,i):void 0},v.prototype=Object.create(l.prototype),v.prototype.constructor=v,Object.defineProperty(v.prototype,"isSyncedResponse",{value:!0}),v.prototype.withAddress=function(e,t){return void 0===e&&(e=this.node),void 0===t&&(t=this.lane),new v(e,t,this.body)},v.prototype.encode=function(){var e=[{node:this.node},{lane:this.lane}];return k.concat({"@synced":e},this.body)},v.decode=function(e){for(var t,n,o=k.tail(e),i=k.head(e),r=i&&i.length||0,s=0;r>s;s+=1){var a=i[s];void 0!==a.node?t=a.node:void 0!==a.lane?n=a.lane:0===s?t=a:1===s&&(n=a)}return void 0!==t&&void 0!==n?new v(t,n,o):void 0},b.prototype=Object.create(c.prototype),b.prototype.constructor=b,Object.defineProperty(b.prototype,"isUnlinkRequest",{value:!0}),b.prototype.withAddress=function(e,t){return void 0===e&&(e=this.node),void 0===t&&(t=this.lane),new b(e,t,this.body)},b.prototype.encode=function(){var e=[{node:this.node},{lane:this.lane}];return k.concat({"@unlink":e},this.body)},b.decode=function(e){for(var t,n,o=k.tail(e),i=k.head(e),r=i&&i.length||0,s=0;r>s;s+=1){var a=i[s];void 0!==a.node?t=a.node:void 0!==a.lane?n=a.lane:0===s?t=a:1===s&&(n=a)}return void 0!==t&&void 0!==n?new b(t,n,o):void 0},g.prototype=Object.create(l.prototype),g.prototype.constructor=g,Object.defineProperty(g.prototype,"isUnlinkedResponse",{value:!0}),g.prototype.withAddress=function(e,t){return void 0===e&&(e=this.node),void 0===t&&(t=this.lane),new g(e,t,this.body)},g.prototype.encode=function(){var e=[{node:this.node},{lane:this.lane}];return k.concat({"@unlinked":e},this.body)},g.decode=function(e){for(var t,n,o=k.tail(e),i=k.head(e),r=i&&i.length||0,s=0;r>s;s+=1){var a=i[s];void 0!==a.node?t=a.node:void 0!==a.lane?n=a.lane:0===s?t=a:1===s&&(n=a)}return void 0!==t&&void 0!==n?new g(t,n,o):void 0},n.decode=o,n.encode=i,n.parse=r,n.stringify=s,n.Envelope=a,n.RequestEnvelope=c,n.ResponseEnvelope=l,n.MessageEnvelope=h,n.EventMessage=p,n.CommandMessage=u,n.SyncRequest=y,n.SyncedResponse=v,n.LinkRequest=d,n.LinkedResponse=f,n.UnlinkRequest=b,n.UnlinkedResponse=g,n.config=m},{"./config.json":3,"recon-js":"recon-js"}],"swim-client-js":[function(e,t,n){(function(n){"use strict";function o(e){e=e||{},Object.defineProperty(this,"options",{value:e,enumerable:!0}),Object.defineProperty(this,"channels",{value:{},configurable:!0})}function i(){Object.defineProperty(this,"downlinks",{value:[],configurable:!0})}function r(e,t){i.call(this),Object.defineProperty(this,"channel",{value:e}),Object.defineProperty(this,"hostUri",{value:t,enumerable:!0}),Object.defineProperty(this,"downlinks",{value:[],configurable:!0})}function s(e,t,n){i.call(this),Object.defineProperty(this,"channel",{value:e}),Object.defineProperty(this,"hostUri",{value:t,enumerable:!0}),Object.defineProperty(this,"nodeUri",{value:n,enumerable:!0}),Object.defineProperty(this,"downlinks",{value:[],configurable:!0})}function a(e,t,n,o){i.call(this),Object.defineProperty(this,"channel",{value:e}),Object.defineProperty(this,"hostUri",{value:t,enumerable:!0}),Object.defineProperty(this,"nodeUri",{value:n,enumerable:!0}),Object.defineProperty(this,"laneUri",{value:o,enumerable:!0}),Object.defineProperty(this,"downlinks",{value:[],configurable:!0})}function c(e,t){Object.defineProperty(this,"hostUri",{value:e,enumerable:!0}),Object.defineProperty(this,"options",{value:t,enumerable:!0}),Object.defineProperty(this,"uriCache",{value:new d(e),configurable:!0}),Object.defineProperty(this,"downlinks",{value:{},configurable:!0}),Object.defineProperty(this,"sendBuffer",{value:[],configurable:!0}),Object.defineProperty(this,"reconnectTimer",{value:null,writable:!0}),Object.defineProperty(this,"reconnectTimeout",{value:0,writable:!0}),Object.defineProperty(this,"idleTimer",{value:null,writable:!0}),Object.defineProperty(this,"socket",{value:null,writable:!0})}function l(e,t,n,o,i){i=i||{},Object.defineProperty(this,"channel",{value:e}),Object.defineProperty(this,"hostUri",{value:t,enumerable:!0}),Object.defineProperty(this,"nodeUri",{value:n,enumerable:!0}),Object.defineProperty(this,"laneUri",{value:o,enumerable:!0}),Object.defineProperty(this,"options",{value:i,enumerable:!0}),Object.defineProperty(this,"delegate",{value:this,writable:!0})}function h(e,t,n,o,i){l.call(this,e,t,n,o,i)}function p(e,t,n,o,i){l.call(this,e,t,n,o,i)}function u(e,t,n,o,i){p.call(this,e,t,n,o,i),Object.defineProperty(this,"state",{value:[],configurable:!0}),Object.defineProperty(this,"table",{value:{},configurable:!0}),this.primaryKey=u.primaryKeyOption(this.options),this.sortBy=u.sortByOption(this.options)}function d(e,t){t=t||32,Object.defineProperty(this,"baseUri",{value:e,enumerable:!0}),Object.defineProperty(this,"base",{value:y.uri.parse(e)}),Object.defineProperty(this,"size",{value:t,enumerable:!0}),Object.defineProperty(this,"resolveCache",{value:new Array(t)}),Object.defineProperty(this,"unresolveCache",{value:new Array(t)})}var f=e("./config.json"),y=e("recon-js"),v=e("swim-proto-js"),b=n.WebSocket||e("websocket").w3cwebsocket;Object.defineProperty(o.prototype,"callChannelWithLinkArgs",{value:function(e,t){var n,i,r,s;2===t.length?(s={},r=t[1],i=t[0],n=o.extractHostUri(i)):3===t.length?"object"==typeof t[2]?(s=t[2],r=t[1],i=t[0],n=o.extractHostUri(i)):(n=t[0],i=o.resolveNodeUri(n,t[1]),r=t[2],s={}):(n=t[0],i=o.resolveNodeUri(n,t[1]),r=t[2],s=t[3]);var a=this.getOrCreateChannel(n);return a[e](i,r,s)},configurable:!0}),o.prototype.getOrCreateChannel=function(e){var t=this.channels[e];return void 0===t&&(t=new c(e,this.options),this.channels[e]=t),t},o.prototype.link=function(){return this.callChannelWithLinkArgs("link",arguments)},o.prototype.sync=function(){return this.callChannelWithLinkArgs("sync",arguments)},o.prototype.syncMap=function(){return this.callChannelWithLinkArgs("syncMap",arguments)},o.prototype.command=function(){var e,t,n,i;3===arguments.length?(i=arguments[2],n=arguments[1],t=arguments[0],e=o.extractHostUri(t)):(e=arguments[0],t=o.resolveNodeUri(e,arguments[1]),n=arguments[2],i=arguments[3]);var r=this.getOrCreateChannel(e);r.command(t,n,i)},o.prototype.host=function(e){var t=this.getOrCreateChannel(e);return new r(t,e)},o.prototype.node=function(){var e,t;1===arguments.length?(t=arguments[0],e=o.extractHostUri(t)):(e=arguments[0],t=o.resolveNodeUri(e,arguments[1]));var n=this.getOrCreateChannel(e);return new s(n,e,t)},o.prototype.lane=function(){var e,t,n;2===arguments.length?(n=arguments[1],t=arguments[0],e=o.extractHostUri(t)):(e=arguments[0],t=o.resolveNodeUri(e,arguments[1]),n=arguments[2]);var i=this.getOrCreateChannel(e);return new a(i,e,t,n)},o.prototype.close=function(){var e=this.channels;Object.defineProperty(this,"channels",{value:{},configurable:!0});for(var t in e){var n=e[t];n.close()}},o.extractHostUri=function(e){var t=y.uri.parse(e),n=t.scheme;return"swim"===n?n="ws":"swims"===n&&(n="wss"),y.uri.stringify({scheme:n,authority:t.authority})},o.resolveNodeUri=function(e,t){return y.uri.stringify(y.uri.resolve(e,t))},i.prototype.registerDownlink=function(e){var t=this;Object.defineProperty(e,"onChannelClose",{value:function(){t.unregisterDownlink(e),e.__proto__.onChannelClose.call(e)},configurable:!0}),this.downlinks.push(e)},i.prototype.unregisterDownlink=function(e){for(var t=0,n=this.downlinks.length;n>t;t+=1)if(e===this.downlinks[t])return void this.downlinks.splice(t,1)},i.prototype.close=function(){var e=this.downlinks;Object.defineProperty(this,"downlinks",{value:[],configurable:!0});for(var t=0,n=e.length;n>t;t+=1){var o=e[t];o.__proto__.onChannelClose.call(o)}},r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.link=function(e,t,n){var i=this.channel.link(o.resolveNodeUri(this.hostUri,e),t,n);return this.registerDownlink(i),i},r.prototype.sync=function(e,t,n){var i=this.channel.sync(o.resolveNodeUri(this.hostUri,e),t,n);return this.registerDownlink(i),i},r.prototype.syncMap=function(){arguments[0]=o.resolveNodeUri(this.hostUri,arguments[0]);var e=this.channel.syncMap.apply(this.channel,arguments);return this.registerDownlink(e),e},r.prototype.command=function(e,t,n){this.channel.command(o.resolveNodeUri(this.hostUri,e),t,n)},r.prototype.node=function(e){return new s(this.channel,this.hostUri,o.resolveNodeUri(this.hostUri,e))},r.prototype.lane=function(e,t){return new a(this.channel,this.hostUri,o.resolveNodeUri(this.hostUri,e),t)},s.prototype=Object.create(i.prototype),s.prototype.constructor=s,s.prototype.link=function(e,t){var n=this.channel.link(this.nodeUri,e,t);return this.registerDownlink(n),n},s.prototype.sync=function(e,t){var n=this.channel.sync(this.nodeUri,e,t);return this.registerDownlink(n),n},s.prototype.syncMap=function(){var e=[this.nodeUri];Array.prototype.push.apply(e,arguments);var t=this.channel.syncMap.apply(this.channel,e);return this.registerDownlink(t),t},s.prototype.command=function(e,t){this.channel.command(this.nodeUri,e,t)},s.prototype.lane=function(e){return new a(this.channel,this.hostUri,this.nodeUri,e)},a.prototype=Object.create(i.prototype),a.prototype.constructor=a,a.prototype.link=function(e){var t=this.channel.link(this.nodeUri,this.laneUri,e);return this.registerDownlink(t),t},a.prototype.sync=function(e){var t=this.channel.sync(this.nodeUri,this.laneUri,e);return this.registerDownlink(t),t},a.prototype.syncMap=function(){var e=[this.nodeUri,this.laneUri];Array.prototype.push.apply(e,arguments);var t=this.channel.syncMap.apply(this.channel,e);return this.registerDownlink(t),t},a.prototype.command=function(e){this.channel.command(this.nodeUri,this.laneUri,e)},Object.defineProperty(c.prototype,"protocols",{get:function(){return this.options.protocols}}),Object.defineProperty(c.prototype,"maxReconnectTimeout",{get:function(){return this.options.maxReconnectTimeout||3e4}}),Object.defineProperty(c.prototype,"idleTimeout",{get:function(){return this.options.idleTimeout||1e3}}),Object.defineProperty(c.prototype,"sendBufferSize",{get:function(){return this.options.sendBufferSize||1024}}),c.prototype.resolve=function(e){return this.uriCache.resolve(e)},c.prototype.unresolve=function(e){return this.uriCache.unresolve(e)},c.prototype.link=function(e,t,n){var o=new h(this,this.hostUri,e,t,n);return this.registerDownlink(o),o},c.prototype.sync=function(e,t,n){var o=new p(this,this.hostUri,e,t,n);return this.registerDownlink(o),o},c.prototype.syncMap=function(e,t,n){var o=new u(this,this.hostUri,e,t,n);return this.registerDownlink(o),o},c.prototype.command=function(e,t,n){var o=new v.CommandMessage(this.unresolve(e),t,n);this.push(o)},c.prototype.registerDownlink=function(e){this.clearIdle();var t=e.nodeUri,n=e.laneUri,o=this.downlinks[t]||{},i=o[n]||[];i.push(e),o[n]=i,this.downlinks[t]=o,this.socket&&this.socket.readyState===this.socket.OPEN?e.onChannelConnect():this.open()},c.prototype.unregisterDownlink=function(e){var t=e.nodeUri,n=e.laneUri,o=this.downlinks[t];if(o){var i=o[n];if(i)for(var r=0,s=i.length;s>r;r+=1)if(i[r]===e){if(i.splice(r,1),0===i.length&&(delete o[n],0===Object.keys(o).length&&(delete this.downlinks[t],this.watchIdle()),this.socket&&this.socket.readyState===this.socket.OPEN)){var a=new v.UnlinkRequest(this.unresolve(t),n);e.onUnlinkRequest(a),this.push(a)}e.onChannelClose()}}},c.prototype.onEnvelope=function(e){e.isEventMessage?this.onEventMessage(e):e.isCommandMessage?this.onCommandMessage(e):e.isLinkRequest?this.onLinkRequest(e):e.isLinkedResponse?this.onLinkedResponse(e):e.isSyncRequest?this.onSyncRequest(e):e.isSyncedResponse?this.onSyncedResponse(e):e.isUnlinkRequest?this.onUnlinkRequest(e):e.isUnlinkedResponse&&this.onUnlinkedResponse(e)},c.prototype.onEventMessage=function(e){var t=this.resolve(e.node),n=e.lane,o=this.downlinks[t];if(o){var i=o[n];if(i)for(var r=e.withAddress(t),s=0,a=i.length;a>s;s+=1){var c=i[s];c.onEventMessage(r)}}},c.prototype.onCommandMessage=function(e){},c.prototype.onLinkRequest=function(e){},c.prototype.onLinkedResponse=function(e){var t=this.resolve(e.node),n=e.lane,o=this.downlinks[t];if(o){var i=o[n];if(i)for(var r=e.withAddress(t),s=0,a=i.length;a>s;s+=1){var c=i[s];c.onLinkedResponse(r)}}},c.prototype.onSyncRequest=function(e){},c.prototype.onSyncedResponse=function(e){var t=this.resolve(e.node),n=e.lane,o=this.downlinks[t];if(o){var i=o[n];if(i)for(var r=e.withAddress(t),s=0,a=i.length;a>s;s+=1){var c=i[s];c.onSyncedResponse(r)}}},c.prototype.onUnlinkRequest=function(e){},c.prototype.onUnlinkedResponse=function(e){var t=this.resolve(e.node),n=e.lane,o=this.downlinks[t];if(o){var i=o[n];if(i){delete o[n],0===Object.keys(o).length&&delete this.downlinks[t];for(var r=e.withAddress(t),s=0,a=i.length;a>s;s+=1){var c=i[s];c.onUnlinkedResponse(r),c.onChannelClose()}}}},c.prototype.onConnect=function(){for(var e in this.downlinks){var t=this.downlinks[e];for(var n in t)for(var o=t[n],i=0,r=o.length;r>i;i+=1){var s=o[i];s.onChannelConnect()}}},c.prototype.onDisconnect=function(){for(var e in this.downlinks){var t=this.downlinks[e];for(var n in t)for(var o=t[n].slice(),i=0,r=o.length;r>i;i+=1){var s=o[i];s.onChannelDisconnect()}}},c.prototype.onError=function(){for(var e in this.downlinks){var t=this.downlinks[e];for(var n in t)for(var o=t[n],i=0,r=o.length;r>i;i+=1){var s=o[i];s.onChannelError()}}},c.prototype.open=function(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.reconnectTimeout=0),this.socket||(this.socket=new b(this.hostUri,this.protocols),this.socket.onopen=this.onWebSocketOpen.bind(this),this.socket.onmessage=this.onWebSocketMessage.bind(this),this.socket.onerror=this.onWebSocketError.bind(this),this.socket.onclose=this.onWebSocketClose.bind(this))},c.prototype.close=function(){this.clearIdle(),this.socket&&(this.socket.close(),this.socket=null);var e=this.downlinks;Object.defineProperty(this,"downlinks",{value:{},configurable:!0});for(var t in e){var n=e[t];for(var o in n)for(var i=n[o],r=0,s=i.length;s>r;r+=1){var a=i[r];a.onChannelClose()}}},c.prototype.reconnect=function(){if(!this.reconnectTimer){if(this.reconnectTimeout){var e=this.maxReconnectTimeout||3e4;this.reconnectTimeout=Math.min(1.8*this.reconnectTimeout,e)}else{var t=1e3*Math.random();this.reconnectTimeout=500+t}this.reconnectTimer=setTimeout(this.open.bind(this),this.reconnectTimeout)}},c.prototype.clearIdle=function(){this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)},c.prototype.watchIdle=function(){this.socket&&this.socket.readyState===this.socket.OPEN&&0===this.sendBuffer.length&&0===Object.keys(this.downlinks).length&&(this.idleTimer=setTimeout(this.checkIdle.bind(this),this.idleTimeout))},c.prototype.checkIdle=function(){0===this.sendBuffer.length&&0===Object.keys(this.downlinks).length&&this.close()},c.prototype.push=function(e){if(this.socket&&this.socket.readyState===this.socket.OPEN){this.clearIdle();var t=v.stringify(e);this.socket.send(t),this.watchIdle()}else e.isCommandMessage&&(this.sendBuffer.length<this.sendBufferSize&&this.sendBuffer.push(e),this.open())},c.prototype.onWebSocketOpen=function(){this.onConnect();for(var e;e=this.sendBuffer.shift();)this.push(e);this.watchIdle()},c.prototype.onWebSocketMessage=function(e){var t=e.data;if("string"==typeof t){var n=v.parse(t);n&&this.onEnvelope(n)}},c.prototype.onWebSocketError=function(){this.onError(),this.clearIdle(),this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.close(),this.socket=null)},c.prototype.onWebSocketClose=function(){this.socket=null,this.onDisconnect(),this.clearIdle(),(this.sendBuffer.length>0||Object.keys(this.downlinks).length>0)&&this.reconnect()},Object.defineProperty(l.prototype,"prio",{get:function(){return this.options.prio||0}}),Object.defineProperty(l.prototype,"keepAlive",{get:function(){return this.options.keepAlive||!1},set:function(e){this.options.keepAlive=e}}),Object.defineProperty(l.prototype,"connected",{get:function(){var e=this.channel.socket;return e&&e.readyState===e.OPEN},enumerable:!0}),Object.defineProperty(l.prototype,"onEventMessage",{value:function(e){"function"==typeof this.delegate.onEvent&&this.delegate.onEvent(e)},configurable:!0}),Object.defineProperty(l.prototype,"onCommandMessage",{value:function(e){"function"==typeof this.delegate.onCommand&&this.delegate.onCommand(e)},configurable:!0}),Object.defineProperty(l.prototype,"onLinkRequest",{value:function(e){"function"==typeof this.delegate.onLink&&this.delegate.onLink(e)},configurable:!0}),Object.defineProperty(l.prototype,"onLinkedResponse",{value:function(e){"function"==typeof this.delegate.onLinked&&this.delegate.onLinked(e)},configurable:!0}),Object.defineProperty(l.prototype,"onSyncRequest",{value:function(e){"function"==typeof this.delegate.onSync&&this.delegate.onSync(e)},configurable:!0}),Object.defineProperty(l.prototype,"onSyncedResponse",{value:function(e){"function"==typeof this.delegate.onSynced&&this.delegate.onSynced(e)},configurable:!0}),Object.defineProperty(l.prototype,"onUnlinkRequest",{value:function(e){"function"==typeof this.delegate.onUnlink&&this.delegate.onUnlink(e)},configurable:!0}),Object.defineProperty(l.prototype,"onUnlinkedResponse",{value:function(e){"function"==typeof this.delegate.onUnlinked&&this.delegate.onUnlinked(e)},configurable:!0}),Object.defineProperty(l.prototype,"onChannelConnect",{value:function(){"function"==typeof this.delegate.onConnect&&this.delegate.onConnect()},configurable:!0}),Object.defineProperty(l.prototype,"onChannelDisconnect",{value:function(){"function"==typeof this.delegate.onDisconnect&&this.delegate.onDisconnect(),this.keepAlive||this.close()},configurable:!0}),Object.defineProperty(l.prototype,"onChannelError",{value:function(){"function"==typeof this.delegate.onError&&this.delegate.onError()},configurable:!0}),Object.defineProperty(l.prototype,"onChannelClose",{value:function(){"function"==typeof this.delegate.onClose&&this.delegate.onClose()},configurable:!0}),l.prototype.close=function(){this.channel.unregisterDownlink(this)},h.prototype=Object.create(l.prototype),h.prototype.constructor=h,Object.defineProperty(h.prototype,"onChannelConnect",{value:function(){l.prototype.onChannelConnect.call(this);var e=this.channel.unresolve(this.nodeUri),t=new v.LinkRequest(e,this.laneUri,this.prio);this.onLinkRequest(t),this.channel.push(t)},configurable:!0}),p.prototype=Object.create(l.prototype),p.prototype.constructor=p,Object.defineProperty(p.prototype,"onChannelConnect",{value:function(){l.prototype.onChannelConnect.call(this);var e=this.channel.unresolve(this.nodeUri),t=new v.SyncRequest(e,this.laneUri,this.prio);this.onSyncRequest(t),this.channel.push(t)},configurable:!0}),u.prototype=Object.create(p.prototype),u.prototype.constructor=u,Object.defineProperty(u.prototype,"onEventMessage",{value:function(e){var t,n=y.tag(e.body);if("@remove"===n){var o=y.tail(e.body);t=this.primaryKey(o),void 0!==t&&this.remoteDelete(t)}else"@clear"===n&&1===y.size(e.body)?this.remoteClear():(t=this.primaryKey(e.body),void 0!==t&&this.remoteSet(t,e.body));p.prototype.onEventMessage.call(this,e)},configurable:!0}),Object.defineProperty(u.prototype,"remoteSet",{value:function(e,t){"string"==typeof e&&(this.table[e]=t);for(var n=0,o=this.state.length;o>n;n+=1){var i=this.state[n],r=this.primaryKey(i);if(y.equal(e,r)){this.state[n]=t;break}}n===o&&this.state.push(t),this.sort()},configurable:!0}),Object.defineProperty(u.prototype,"remoteDelete",{value:function(e){"string"==typeof e&&delete this.table[e];for(var t=0,n=this.state.length;n>t;t+=1){var o=this.state[t],i=this.primaryKey(o);if(y.equal(e,i))return void this.state.splice(t,1)}},configurable:!0}),Object.defineProperty(u.prototype,"remoteClear",{value:function(e){Object.defineProperty(this,"state",{value:[],configurable:!0}),Object.defineProperty(this,"table",{value:{},configurable:!0})},configurable:!0}),Object.defineProperty(u.prototype,"size",{get:function(){return this.state.length},configurable:!0,enumerable:!0}),u.prototype.has=function(e){if("string"==typeof e)return void 0!==this.table[e];for(var t=0,n=this.state.length;n>t;t+=1){var o=this.state[t],i=this.primaryKey(o);if(y.equal(e,i))return!0}return!1},u.prototype.get=function(e){if("string"==typeof e)return this.table[e];for(var t=0,n=this.state.length;n>t;t+=1){var o=this.state[t],i=this.primaryKey(o);if(y.equal(e,i))return o}},u.prototype.set=function(e,t){"string"==typeof e&&(this.table[e]=t);for(var n=0,o=this.state.length;o>n;n+=1){var i=this.state[n],r=this.primaryKey(i);if(y.equal(e,r)){this.state[n]=t;break}}n===o&&this.state.push(t),this.sort();var s=this.channel.unresolve(this.nodeUri),a=new v.CommandMessage(s,this.laneUri,t);return this.onCommandMessage(a),this.channel.push(a),this},u.prototype["delete"]=function(e){"string"==typeof e&&delete this.table[e];for(var t=0,n=this.state.length;n>t;t+=1){var o=this.state[t],i=this.primaryKey(o);if(y.equal(e,i)){this.state.splice(t,1);var r=this.channel.unresolve(this.nodeUri),s=y.concat({"@remove":null},o),a=new v.CommandMessage(r,this.laneUri,s);return this.onCommandMessage(a),this.channel.push(a),!0}}return!1},u.prototype.clear=function(){Object.defineProperty(this,"state",{value:[],configurable:!0}),Object.defineProperty(this,"table",{value:{},configurable:!0});var e=this.channel.unresolve(this.nodeUri),t=new v.CommandMessage(e,this.laneUri,[{"@clear":null}]);return this.onCommandMessage(t),this.channel.push(t),this},u.prototype.sort=function(){this.sortBy&&this.state.sort(this.sortBy)},u.prototype.keys=function(){for(var e=[],t=0,n=this.state.length;n>t;t+=1){var o=this.state[t],i=this.primaryKey(o);void 0!==i&&e.push(i)}return e},u.prototype.values=function(){return this.state},u.prototype.forEach=function(e,t){for(var n=0,o=this.state.length;o>n;n+=1){var i=this.state[n];e.call(t,i,this)}},u.primaryKeyOption=function(e){if("function"==typeof e.primaryKey)return e.primaryKey;if("string"==typeof e.primaryKey){var t=e.primaryKey.split(".");return function(e){for(var n=0,o=t.length;o>n;n+=1){var i=t[n];e=y.get(e,i)}return e}}return u.identityKey},u.identityKey=function(e){return e},u.sortByOption=function(e){if("function"==typeof e.sortBy)return e.sortBy;if("string"==typeof e.sortBy){var t=e.sortBy.split(".");return function(e,n){for(var o=0,i=t.length;i>o;o+=1){var r=t[o];return e=y.get(e,r),n=y.get(n,r),y.compare(e,n)}}}},d.prototype.resolve=function(e){var t=Math.abs(d.hash(e)%this.size),n=this.resolveCache[t];if(n&&n.unresolved===e)return n.resolved;var o=y.uri.stringify(y.uri.resolve(this.base,e));return this.resolveCache[t]={unresolved:e,resolved:o},o},d.prototype.unresolve=function(e){var t=Math.abs(d.hash(e)%this.size),n=this.unresolveCache[t];if(n&&n.resolved===e)return n.unresolved;var o=y.uri.stringify(y.uri.unresolve(this.base,e));return this.unresolveCache[t]={unresolved:o,resolved:e},o},d.rotl=function(e,t){return e<<t|e>>>32-t},d.mix=function(e,t){return t*=3432918353,t=d.rotl(t,15),t*=461845907,e^=t,e=d.rotl(e,13),e=5*e+3864292196},d.mash=function(e){return e^=e>>>16,e*=2246822507,e^=e>>>13,e*=3266489909,e^=e>>>16},d.hash=function(e){for(var t=0,n=0,o=e.length;o>n;n+=1)t=d.mix(t,e.charAt(n));return t=d.mash(t)};var g=new o;g.client=function(e){return new o(e)},g.config=f,t.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./config.json":1,"recon-js":"recon-js","swim-proto-js":4,websocket:2}]},{},[])("swim-client-js")});
//# sourceMappingURL=swim-client.min.js.map
